{
    "$schema": "https://json-schema.org/draft-07/schema",
    "$id": "https://raw.githubusercontent.com/phac-nml/measeq/main/nextflow_schema.json",
    "title": "phac-nml/measeq pipeline parameters",
    "description": "Measles sequencing and analysis",
    "type": "object",
    "definitions": {
        "input_output_options": {
            "title": "Input/output options",
            "type": "object",
            "fa_icon": "fas fa-terminal",
            "description": "Define where the pipeline should find input data and save output data.",
            "required": ["input", "outdir"],
            "properties": {
                "input": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "schema": "assets/schema_input.json",
                    "mimetype": "text/csv",
                    "pattern": "^\\S+\\.csv$",
                    "description": "Path to comma-separated file containing information about the samples in the experiment.",
                    "help_text": "You will need to create a design file with information about the samples in your experiment before running the pipeline. Use this parameter to specify its location. It has to be a comma-separated file with 3 columns, and a header row.",
                    "fa_icon": "fas fa-file-csv"
                },
                "outdir": {
                    "type": "string",
                    "format": "directory-path",
                    "description": "The output directory where the results will be saved. You have to use absolute paths to storage on Cloud infrastructure.",
                    "fa_icon": "fas fa-folder-open"
                }
            }
        },
        "required_options": {
            "title": "Required options",
            "type": "object",
            "description": "Options that are required to run the pipeline no matter what",
            "default": "",
            "properties": {
                "platform": {
                    "type": "string",
                    "description": "Sequencing platform used. Options are: 'illumina' or 'nanopore'",
                    "enum": ["illumina", "nanopore"],
                    "fa_icon": "fas fa-vector-square"
                }
            },
            "required": ["platform"],
            "fa_icon": "fas fa-check"
        },
        "amplicon_options": {
            "title": "Amplicon options",
            "type": "object",
            "description": "Options relating to running amplicon data",
            "default": "",
            "properties": {
                "primer_bed": {
                    "type": "string",
                    "description": "Path to amplicon primer bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt"
                },
                "amplicon": {
                    "type": "boolean",
                    "description": "Run with amplicon data"
                }
            },
            "fa_icon": "fas fa-vials"
        },
        "illumina_options": {
            "title": "Illumina variant calling thresholds",
            "type": "object",
            "description": "Options specific to Illumina variant calling thresholds",
            "default": "",
            "properties": {
                "remove_duplicates": {
                    "type": "boolean",
                    "description": "Mark and remove optical duplicates with picard markduplicates"
                },
                "ivar_trim_min_read_length": {
                    "type": "integer",
                    "description": "Minimum length of read to retain after trimming",
                    "default": 30,
                    "minimum": 0,
                    "fa_icon": "far fa-minus-square"
                },
                "min_ambiguity_threshold": {
                    "type": "number",
                    "description": "Minimum threshold to call a position as an IUPAC",
                    "default": 0.3,
                    "minimum": 0,
                    "maximum": 1,
                    "fa_icon": "far fa-minus-square"
                },
                "max_ambiguity_threshold": {
                    "type": "number",
                    "description": "Maximum threshold to call a position as an IUPAC",
                    "default": 0.75,
                    "minimum": 0,
                    "maximum": 1,
                    "fa_icon": "far fa-plus-square"
                },
                "min_indel_threshold": {
                    "type": "number",
                    "description": "Minimum thresholds to keep an indel",
                    "default": 0.6,
                    "minimum": 0,
                    "maximum": 1,
                    "fa_icon": "far fa-minus-square"
                },
                "min_alt_fraction_freeabyes": {
                    "type": "number",
                    "description": "Require at least this fraction of observations supporting an alt allele to evaluate position",
                    "default": 0.05,
                    "minimum": 0,
                    "maximum": 1,
                    "fa_icon": "far fa-minus-square"
                },
                "min_variant_qual_freebayes": {
                    "type": "integer",
                    "description": "Minimum freebayes quality (probability) to filter variants",
                    "default": 20,
                    "minimum": 0,
                    "fa_icon": "far fa-minus-square"
                }
            }
        },
        "nanopore_options": {
            "title": "Nanopore options",
            "type": "object",
            "description": "Options specific to Nanopore data",
            "default": "",
            "properties": {
                "model": {
                    "type": "string",
                    "description": "Clair3 model to use for variant calling. Will attempt to download the model",
                    "fa_icon": "fab fa-modx"
                },
                "local_model": {
                    "type": "string",
                    "description": "Path to local clair3 model directory for variant calling",
                    "format": "directory-path",
                    "fa_icon": "fab fa-modx"
                },
                "normalise_ont": {
                    "type": "integer",
                    "default": 2000,
                    "minimum": 0,
                    "description": "Normalise each amplicon barcode to set depth"
                },
                "min_variant_qual_c3": {
                    "type": "integer",
                    "default": 8,
                    "minimum": 0,
                    "description": "Minimum variant quality to pass clair3 filters"
                },
                "ont_min_read_length": {
                    "type": "integer",
                    "default": 200,
                    "minimum": 0,
                    "description": "Minimum read length for input ONT reads"
                }
            }
        },
        "analysis_options": {
            "title": "Analysis options",
            "type": "object",
            "description": "Options related to the analysis of data or adding in data",
            "default": "",
            "properties": {
                "reference": {
                    "type": "string",
                    "description": "Path to reference sequence to map measles fastqs to",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt"
                },
                "metadata": {
                    "type": "string",
                    "pattern": "^\\S+\\.tsv$",
                    "format": "file-path",
                    "description": "Path to metadata TSV file containing at minimum 'sample' column to add to final output",
                    "fa_icon": "fas fa-file-csv",
                    "hidden": true
                },
                "dsid_fasta": {
                    "type": "string",
                    "description": "Path to DSID multi-fasta to match output consensus data to",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt"
                },
                "min_depth": {
                    "type": "integer",
                    "default": 10,
                    "minimum": 0,
                    "description": "Minimum depth to call a base"
                },
                "no_frameshifts": {
                    "type": "boolean",
                    "description": "Fail all indel variants not divisible by 3"
                },
                "neg_control_pct_threshold": {
                    "type": "integer",
                    "default": 10,
                    "minimum": 0,
                    "maximum": 100,
                    "description": "Genome called threshold for negative control to be considered failed"
                },
                "neg_ctrl_substrings": {
                    "type": "string",
                    "pattern": "^\\S+$",
                    "default": "neg,ntc,blank,en",
                    "description": "Substrings to match to sample names to identify negative controls. Separated by a ,"
                },
                "skip_negative_grading": {
                    "type": "boolean",
                    "description": "Skip grading negative controls and give the run a PASS",
                    "fa_icon": "fas fa-forward"
                }
            }
        },
        "nextclade_options": {
            "title": "Nextclade options",
            "type": "object",
            "description": "Options pertaining to nextclade datasets. These shouldn't be adjusted likely",
            "default": "",
            "properties": {
                "nextclade_dataset_name": {
                    "type": "string",
                    "enum": ["nextstrain/measles/N450/WHO-2012"],
                    "default": "nextstrain/measles/N450/WHO-2012",
                    "description": "Name of the nextclade dataset to use. Shouldn't be changed unless needed"
                },
                "nextclade_dataset_tag": {
                    "type": "string",
                    "enum": ["2025-03-26--11-47-13Z"],
                    "default": "2025-03-26--11-47-13Z",
                    "description": "Tag for the nextclade dataset to use. Shouldn't be changed unless needed"
                }
            }
        },
        "generic_options": {
            "title": "Generic options",
            "type": "object",
            "fa_icon": "fas fa-file-import",
            "description": "Less common options for the pipeline, typically set in a config file.",
            "help_text": "These options are common to all nf-core pipelines and allow you to customise some of the core preferences for how the pipeline runs.\n\nTypically these options would be set in a Nextflow config file loaded for all pipeline runs, such as `~/.nextflow/config`.",
            "properties": {
                "help": {
                    "type": "boolean",
                    "description": "Display help message and exit.",
                    "fa_icon": "fas fa-question-circle",
                    "hidden": true
                },
                "version": {
                    "type": "boolean",
                    "description": "Display version and exit.",
                    "fa_icon": "fas fa-question-circle",
                    "hidden": true
                },
                "publish_dir_mode": {
                    "type": "string",
                    "default": "copy",
                    "description": "Method used to save pipeline results to output directory.",
                    "help_text": "The Nextflow `publishDir` option specifies which intermediate files should be saved to the output directory. This option tells the pipeline what method should be used to move these files. See [Nextflow docs](https://www.nextflow.io/docs/latest/process.html#publishdir) for details.",
                    "fa_icon": "fas fa-copy",
                    "enum": ["symlink", "rellink", "link", "copy", "copyNoFollow", "move"],
                    "hidden": true
                },
                "monochrome_logs": {
                    "type": "boolean",
                    "description": "Do not use coloured log outputs.",
                    "fa_icon": "fas fa-palette",
                    "hidden": true
                },
                "validate_params": {
                    "type": "boolean",
                    "description": "Boolean whether to validate parameters against the schema at runtime",
                    "default": true,
                    "fa_icon": "fas fa-check-square",
                    "hidden": true
                },
                "trace_report_suffix": {
                    "type": "string",
                    "fa_icon": "far calendar",
                    "description": "Suffix to add to the trace report filename. Default is the date and time in the format yyyy-MM-dd_HH-mm-ss.",
                    "hidden": true
                }
            }
        },
        "reference_options": {
            "title": "Reference options",
            "type": "object",
            "description": "Reference options when no specific reference is specified in the command",
            "properties": {
                "default_ref": {
                    "type": "string",
                    "description": "Path to D8 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "default_bed": {
                    "type": "string",
                    "description": "Path to D8 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "A_ref": {
                    "type": "string",
                    "description": "Path to A reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "A_bed": {
                    "type": "string",
                    "description": "Path to A primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "B1_ref": {
                    "type": "string",
                    "description": "Path to B1 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "B1_bed": {
                    "type": "string",
                    "description": "Path to B1 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "B2_ref": {
                    "type": "string",
                    "description": "Path to B2 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "B2_bed": {
                    "type": "string",
                    "description": "Path to B2 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "B3_ref": {
                    "type": "string", 
                    "description": "Path to B3 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "B3_bed": {
                    "type": "string",
                    "description": "Path to B3 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "C1_ref": {
                    "type": "string",
                    "description": "Path to C1 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "C1_bed": {
                    "type": "string",
                    "description": "Path to C1 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "C2_ref": {
                    "type": "string",
                    "description": "Path to C2 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "C2_bed": {
                    "type": "string",
                    "description": "Path to C2 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D1_ref": {
                    "type": "string",
                    "description": "Path to D1 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D1_bed": {
                    "type": "string",
                    "description": "Path to D1 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D2_ref": {
                    "type": "string",
                    "description": "Path to D2 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D2_bed": {
                    "type": "string",
                    "description": "Path to D2 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D3_ref": {
                    "type": "string",
                    "description": "Path to D3 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D3_bed": {
                    "type": "string",
                    "description": "Path to D3 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D4_ref": {
                    "type": "string",
                    "description": "Path to D4 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D4_bed": {
                    "type": "string",
                    "description": "Path to D4 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D5_ref": {
                    "type": "string",
                    "description": "Path to D5 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D5_bed": {
                    "type": "string",
                    "description": "Path to D5 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D6_ref": {
                    "type": "string",
                    "description": "Path to D6 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D6_bed": {
                    "type": "string",
                    "description": "Path to D6 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D7_ref": {
                    "type": "string",
                    "description": "Path to D7 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D7_bed": {
                    "type": "string",
                    "description": "Path to D7 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D8_ref": {
                    "type": "string",
                    "description": "Path to D8 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D8_bed": {
                    "type": "string",
                    "description": "Path to D8 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D9_ref": {
                    "type": "string",
                    "description": "Path to D9 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D9_bed": {
                    "type": "string",
                    "description": "Path to D9 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D10_ref": {
                    "type": "string",
                    "description": "Path to D10 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D10_bed": {
                    "type": "string",
                    "description": "Path to D10 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D11_ref": {
                    "type": "string",
                    "description": "Path to D11 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "D11_bed": {
                    "type": "string",
                    "description": "Path to D11 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "E_ref": {
                    "type": "string",
                    "description": "Path to E reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "E_bed": {
                    "type": "string",
                    "description": "Path to E primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "F_ref": {
                    "type": "string",
                    "description": "Path to F reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "F_bed": {
                    "type": "string",
                    "description": "Path to F primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "G1_ref": {
                    "type": "string",
                    "description": "Path to G1 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "G1_bed": {
                    "type": "string",
                    "description": "Path to G1 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "G2_ref": {
                    "type": "string",
                    "description": "Path to G2 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "G2_bed": {
                    "type": "string",
                    "description": "Path to G2 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "G3_ref": {
                    "type": "string",
                    "description": "Path to G3 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "G3_bed": {
                    "type": "string",
                    "description": "Path to G3 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "H1_ref": {
                    "type": "string",
                    "description": "Path to H1 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "H1_bed": {
                    "type": "string",
                    "description": "Path to H1 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "H2_ref": {
                    "type": "string",
                    "description": "Path to H2 reference fasta",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                },
                "H2_bed": {
                    "type": "string",
                    "description": "Path to H2 primers bed file",
                    "format": "file-path",
                    "fa_icon": "far fa-file-alt",
                    "hidden": true
                }
            }
        },
        "contact_options": {
            "title": "Contact information options",
            "type": "object",
            "description": "Options relating to contact information printing on final report",
            "default": "",
            "properties": {
                "contact_name": {
                    "type": "string",
                    "description": "Name of the person or organization running the pipeline",
                    "fa_icon": "fas fa-vector-square"
                },
                "contact_website": {
                    "type": "string",
                    "description": "Website of the person or organization running the pipeline",
                    "fa_icon": "fas fa-vector-square"
                },
                "contact_phone": {
                    "type": "string",
                    "description": "Phone number of the person or organization running the pipeline",
                    "fa_icon": "fas fa-vector-square"
                },
                "contact_email": {
                    "type": "string",
                    "description": "Email of the person or organization running the pipeline",
                    "fa_icon": "fas fa-vector-square"
                }
            }
        }
    },
    "allOf": [
        {
            "$ref": "#/definitions/input_output_options"
        },
        {
            "$ref": "#/definitions/required_options"
        },
        {
            "$ref": "#/definitions/amplicon_options"
        },
        {
            "$ref": "#/definitions/illumina_options"
        },
        {
            "$ref": "#/definitions/nanopore_options"
        },
        {
            "$ref": "#/definitions/analysis_options"
        },
        {
            "$ref": "#/definitions/nextclade_options"
        },
        {
            "$ref": "#/definitions/generic_options"
        },
        {
            "$ref": "#/definitions/reference_options"
        },
        {
            "$ref": "#/definitions/contact_options"
        }
    ]
}
